{"version":3,"sources":["PressGestureHandler.ts"],"names":["Hammer","State","CONTENT_TOUCHES_DELAY","CONTENT_TOUCHES_QUICK_TAP_END_DELAY","DiscreteGestureHandler","fireAfterInterval","isValidNumber","isnan","PressGestureHandler","name","minDurationMs","config","maxDist","NativeGestureClass","Press","simulateCancelEvent","inputData","hasGestureFailed","cancelEvent","updateHasCustomActivationCriteria","shouldCancelWhenOutside","maxDistSq","getState","type","INPUT_START","BEGAN","INPUT_MOVE","ACTIVE","INPUT_END","END","INPUT_CANCEL","CANCELLED","getConfig","hasCustomActivationCriteria","getHammerConfig","time","onGestureActivated","ev","onGestureStart","shouldDelayTouchForEvent","pointerType","shouldDelayTouches","isGestureRunning","clearTimeout","visualFeedbackTimer","initialEvent","sendGestureStartedEvent","sendEvent","eventType","isFirst","forceInvalidate","event","onRawEvent","isFinal","timeout","onGestureEnded","updateGestureConfig","shouldActivateOnStart","disallowInterruption","Number","NaN","minPointers","maxPointers","props"],"mappings":"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","sourcesContent":["import Hammer from '@egjs/hammerjs';\r\n\r\nimport { State } from '../State';\r\nimport {\r\n  CONTENT_TOUCHES_DELAY,\r\n  CONTENT_TOUCHES_QUICK_TAP_END_DELAY,\r\n  HammerInputNames,\r\n} from './constants';\r\nimport DiscreteGestureHandler from './DiscreteGestureHandler';\r\nimport { Config, HammerInputExt } from './GestureHandler';\r\nimport { fireAfterInterval, isValidNumber, isnan } from './utils';\r\n\r\nclass PressGestureHandler extends DiscreteGestureHandler {\r\n  private visualFeedbackTimer: any;\r\n  private initialEvent: HammerInputExt | null = null;\r\n  get name() {\r\n    return 'press';\r\n  }\r\n\r\n  get minDurationMs() {\r\n    // @ts-ignore FIXME(TS)\r\n    return isnan(this.config.minDurationMs) ? 5 : this.config.minDurationMs;\r\n  }\r\n\r\n  get maxDist() {\r\n    return isnan(this.config.maxDist) ? 9 : this.config.maxDist;\r\n  }\r\n\r\n  get NativeGestureClass() {\r\n    return Hammer.Press;\r\n  }\r\n\r\n  shouldDelayTouches = true;\r\n\r\n  simulateCancelEvent(inputData: HammerInputExt) {\r\n    // Long press never starts so we can't rely on the running event boolean.\r\n    this.hasGestureFailed = true;\r\n    this.cancelEvent(inputData);\r\n  }\r\n\r\n  updateHasCustomActivationCriteria({\r\n    shouldCancelWhenOutside,\r\n    maxDistSq,\r\n  }: Config & { shouldCancelWhenOutside: boolean }) {\r\n    return shouldCancelWhenOutside || !isValidNumber(maxDistSq);\r\n  }\r\n\r\n  getState(type: keyof typeof HammerInputNames): State {\r\n    return {\r\n      [Hammer.INPUT_START]: State.BEGAN,\r\n      [Hammer.INPUT_MOVE]: State.ACTIVE,\r\n      [Hammer.INPUT_END]: State.END,\r\n      [Hammer.INPUT_CANCEL]: State.CANCELLED,\r\n    }[type];\r\n  }\r\n\r\n  getConfig() {\r\n    if (!this.hasCustomActivationCriteria) {\r\n      // Default config\r\n      // If no params have been defined then this config should emulate the native gesture as closely as possible.\r\n      return {\r\n        shouldCancelWhenOutside: true,\r\n        maxDistSq: 10,\r\n      };\r\n    }\r\n    return this.config;\r\n  }\r\n\r\n  getHammerConfig() {\r\n    return {\r\n      ...super.getHammerConfig(),\r\n      // threshold: this.maxDist,\r\n      time: this.minDurationMs,\r\n    };\r\n  }\r\n\r\n  onGestureActivated(ev: HammerInputExt) {\r\n    this.onGestureStart(ev);\r\n  }\r\n\r\n  shouldDelayTouchForEvent({ pointerType }: HammerInputExt) {\r\n    // Don't disable event for mouse input\r\n    return this.shouldDelayTouches && pointerType === 'touch';\r\n  }\r\n\r\n  onGestureStart(ev: HammerInputExt) {\r\n    this.isGestureRunning = true;\r\n    clearTimeout(this.visualFeedbackTimer);\r\n    this.initialEvent = ev;\r\n    this.visualFeedbackTimer = fireAfterInterval(() => {\r\n      this.sendGestureStartedEvent(this.initialEvent as HammerInputExt);\r\n      this.initialEvent = null;\r\n    }, this.shouldDelayTouchForEvent(ev) && CONTENT_TOUCHES_DELAY);\r\n  }\r\n\r\n  sendGestureStartedEvent(ev: HammerInputExt) {\r\n    clearTimeout(this.visualFeedbackTimer);\r\n    this.visualFeedbackTimer = null;\r\n    this.sendEvent({\r\n      ...ev,\r\n      eventType: Hammer.INPUT_MOVE,\r\n      isFirst: true,\r\n    });\r\n  }\r\n\r\n  forceInvalidate(event: HammerInputExt) {\r\n    super.forceInvalidate(event);\r\n    clearTimeout(this.visualFeedbackTimer);\r\n    this.visualFeedbackTimer = null;\r\n    this.initialEvent = null;\r\n  }\r\n\r\n  onRawEvent(ev: HammerInputExt) {\r\n    super.onRawEvent(ev);\r\n    if (this.isGestureRunning) {\r\n      if (ev.isFinal) {\r\n        let timeout;\r\n        if (this.visualFeedbackTimer) {\r\n          // Aesthetic timing for a quick tap.\r\n          // We haven't activated the tap right away to emulate iOS `delaysContentTouches`\r\n          // Now we must send the initial activation event and wait a set amount of time before firing the end event.\r\n          timeout = CONTENT_TOUCHES_QUICK_TAP_END_DELAY;\r\n          this.sendGestureStartedEvent(this.initialEvent as HammerInputExt);\r\n          this.initialEvent = null;\r\n        }\r\n        fireAfterInterval(() => {\r\n          this.sendEvent({\r\n            ...ev,\r\n            eventType: Hammer.INPUT_END,\r\n            isFinal: true,\r\n          });\r\n          // @ts-ignore -- this should explicitly support undefined\r\n          this.onGestureEnded();\r\n        }, timeout);\r\n      } else {\r\n        this.sendEvent({\r\n          ...ev,\r\n          eventType: Hammer.INPUT_MOVE,\r\n          isFinal: false,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  updateGestureConfig({\r\n    shouldActivateOnStart = false,\r\n    disallowInterruption = false,\r\n    shouldCancelWhenOutside = true,\r\n    minDurationMs = Number.NaN,\r\n    maxDist = Number.NaN,\r\n    minPointers = 1,\r\n    maxPointers = 1,\r\n    ...props\r\n  }) {\r\n    return super.updateGestureConfig({\r\n      shouldActivateOnStart,\r\n      disallowInterruption,\r\n      shouldCancelWhenOutside,\r\n      minDurationMs,\r\n      maxDist,\r\n      minPointers,\r\n      maxPointers,\r\n      ...props,\r\n    });\r\n  }\r\n}\r\nexport default PressGestureHandler;\r\n"]}